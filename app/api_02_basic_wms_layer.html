<!doctype html>
<html class="no-js">
	<head>
		<meta charset="utf-8">
		<title>The TMB-API - Code samples</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width">
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
		<link rel="icon" href="favicon.ico" type="image/x-icon">

		<!-- build:css styles/vendor.css -->
		<!-- bower:css -->
		<link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.css" />
		<link rel="stylesheet" href="../bower_components/highlightjs/styles/mono-blue.css" />
		<link rel="stylesheet" href="../bower_components/seiyria-bootstrap-slider/dist/css/bootstrap-slider.css" />
		<link rel="stylesheet" href="../bower_components/bootstrap-toggle/css/bootstrap-toggle.min.css" />
		<!-- endbower -->
		<!-- endbuild -->

		<!-- bootswatch yeti theme -->
		<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/yeti/bootstrap.min.css" rel="stylesheet">

		<!-- build:css(.tmp) styles/main.css -->
		<link rel="stylesheet" href="styles/main.css">
		<!-- endbuild -->

		<!-- OpenLayers -->
		<link rel="stylesheet" href="http://ol3js.org/en/master/css/ol.css">
	</head>
	<body>
		<!--[if lt IE 10]>
		<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
		<![endif]-->

		<div class="container">

			<div class="header">
				
			    <h1><a href="index.html">The TMB - API <span class="text-muted">[Code samples]</span></a></h1>

			    <p>These are the code samples for <a href="https://developer.tmb.cat/">The TMB API</a>.

			    <div>

			    </div>
			</div>

			<h2>Load WMS layer</h2>

			<p>
				This sample shows how to load a WMS layer. Passing layer name by GET parameter as <i><b>layer=layer_name</b></i> you can load it on map, e.g. <a href="./api_02_basic_wms_layer.html?layer=CARTO_TMB">?layer=CARTO_TMB</a>
			</p>

			<div id="map" class="map"></div>

			<h4 class="text-muted">Source code:</h4>
			<pre><code id="code_text" class="javascript"></code></pre>			

            <div class="footer">
                <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Code samples for The TMB API</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.tmb.cat/" property="cc:attributionName" rel="cc:attributionURL">Transports Metropolitans de Barcelona</a> is derivated from <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Code samples for The Book of OpenLayers3</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://github.com/acanimal/thebookofopenlayers3" property="cc:attributionName" rel="cc:attributionURL">Antonio Santiago</a> licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>..</p>
            </div>


		</div>

		<!-- build:js scripts/vendor.js -->
		<!-- bower:js -->
		<script src="../bower_components/modernizr/modernizr.js"></script>
		<script src="../bower_components/jquery/dist/jquery.js"></script>
		<script src="../bower_components/highlightjs/highlight.pack.js"></script>
		<script src="../bower_components/seiyria-bootstrap-slider/js/bootstrap-slider.js"></script>
		<script src="../bower_components/bootstrap-toggle/js/bootstrap-toggle.min.js"></script>
		<!-- endbower -->
		<!-- endbuild -->

		<!-- build:js scripts/plugins.js -->
		<script src="../bower_components/bootstrap/js/affix.js"></script>
		<script src="../bower_components/bootstrap/js/alert.js"></script>
		<script src="../bower_components/bootstrap/js/dropdown.js"></script>
		<script src="../bower_components/bootstrap/js/tooltip.js"></script>
		<script src="../bower_components/bootstrap/js/modal.js"></script>
		<script src="../bower_components/bootstrap/js/transition.js"></script>
		<script src="../bower_components/bootstrap/js/button.js"></script>
		<script src="../bower_components/bootstrap/js/popover.js"></script>
		<script src="../bower_components/bootstrap/js/carousel.js"></script>
		<script src="../bower_components/bootstrap/js/scrollspy.js"></script>
		<script src="../bower_components/bootstrap/js/collapse.js"></script>
		<script src="../bower_components/bootstrap/js/tab.js"></script>
		<!-- endbuild -->

		<!-- OpenLayers -->
		<script src="http://ol3js.org/en/master/build/ol.js"></script>

		<!-- Google Analytics -->
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		  ga('create', 'Google analytics key', 'auto');
		  ga('send', 'pageview');

		</script>

		<script>
			var write_here_your_app_key = 'c1708a798d0c879002694a90b825937a';
			var write_here_your_app_id = 'f7b34f42';
		</script>

		<script id="code">

			/**
			 * Get layer parameter from URL
			 * @param key
			 * @returns {*}
			 */
			var getURLParameters = function(key) {
				var KEY = 0, VALUE = 1;
				var onlyParameters = window.location.href.split('?')[1];
				if ( typeof onlyParameters == "undefined") {
					return null;
				}
				var parametersAsString = onlyParameters.split('&');
				var parameters = {};
				for (var pair = 0; pair < parametersAsString.length; pair++) {
					var keyAndValue = parametersAsString[pair].split('=');
					if (keyAndValue[KEY] == key) {
						console.log(keyAndValue[VALUE]);
						return keyAndValue[VALUE];
					}
				}
				return null;
			};

			var layers = [new ol.layer.Tile({
				source : new ol.source.TileWMS({
					params : {
						'LAYERS' : 'OI.OrthoimageCoverage',
						'FORMAT' : 'image/png'
					},
					url : 'http://www.ign.es/wms-inspire/pnoa-ma'
				})
			})];

			var map = new ol.Map({
				layers : layers,
				target : 'map',
				view : new ol.View({
					center : new ol.proj.transform([2.1574, 41.3987], "EPSG:4326", "EPSG:3857"),
					projection : 'EPSG:3857',
					zoom : 13
				})
			});

			var nameLayer = getURLParameters('layer');

			if (!nameLayer) {
				nameLayer = 'XARXA_METRO';
			};

			var overlay = new ol.layer.Tile({
				source : new ol.source.TileWMS({
					params : {
						'LAYERS' : nameLayer,
						'FORMAT' : 'image/png',
						'app_key' : write_here_your_app_key,
						'app_id' : write_here_your_app_id,
						'name' : nameLayer
					},
					url : 'http://api.tmb.cat/v1/maps/wms'
				})
			})

			map.addLayer(overlay);
		</script>

		<script>
			(function() {
				$('#code_text').text( $('#code').text() );
		    	hljs.initHighlightingOnLoad();
			})();
		</script>

	</body>
</html>
